<!doctype html>
<html lang="zh-CN">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>PDB Manager • 登录 / 注册</title>
<style>
    :root {
        --glass: rgba(255, 255, 255, .25);
        --brd: rgba(255, 255, 255, .35);
        --brand: #6366f1
    }

    html, body {
        height: 100%;
        margin: 0;
        font-family: -apple-system, system-ui, Roboto, sans-serif
    }

    body {
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) fixed
    }

    .card {
        width: min(420px, 90%);
        padding: 3.5rem 3rem;
        border-radius: 1.2rem;
        backdrop-filter: blur(32px) saturate(150%);
        background: var(--glass);
        border: 1px solid var(--brd);
        box-shadow: 0 15px 35px rgba(0, 0, 0, .15);
        animation: fade .6s ease
    }

    h1 {
        margin: 0 0 2rem;
        font-size: 1.8rem;
        color: #fff;
        text-align: center
    }

    label {
        display: block;
        margin: .8rem 0 .25rem;
        font-size: .9rem;
        color: #f1f1f1
    }

    input {
        width: 100%;
        padding: .75rem 1rem;
        border: none;
        border-radius: .6rem;
        background: rgba(255, 255, 255, .9);
        font-size: 1rem
    }

    input:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, .35)
    }

    button {
        width: 100%;
        margin-top: 2rem;
        padding: .8rem;
        border: none;
        border-radius: .8rem;
        background: var(--brand);
        color: #fff;
        font-size: 1.05rem;
        font-weight: 600;
        cursor: pointer;
        transition: .25s
    }

    button:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, .25)
    }

    .switcher {
        margin-top: 1.5rem;
        text-align: center;
        color: #f1f1f1;
        font-size: .9rem;
        cursor: pointer
    }

    #error {
        color: #ffb4b4;
        margin-top: 1rem;
        text-align: center;
        min-height: 1.2rem
    }

    @keyframes fade {
        from {
            opacity: 0;
            transform: translateY(16px)
        }
        to {
            opacity: 1;
            transform: none
        }
    }
</style>

<div class="card">
    <h1 id="title">登录到 ProVR</h1>
    <form id="form">
        <label>用户名</label>
        <input name="username" id="username" autocomplete="username" required>
        <label>密码</label>
        <input name="password" id="password" type="password" autocomplete="current-password" required>
        <button id="submitBtn">登录</button>
        <div id="error"></div>
    </form>
    <div class="switcher" id="switcher">没有账号？立即注册</div>
</div>

<script>
    const MODE = {login: "login", register: "register"};
    let cur = MODE.login;
    const title = document.getElementById("title"),
        switcher = document.getElementById("switcher"),
        submit = document.getElementById("submitBtn"),
        form = document.getElementById("form"),
        err = document.getElementById("error");
    switcher.onclick = () => setMode(cur === MODE.login ? MODE.register : MODE.login);

    function setMode(m) {
        cur = m;
        const l = m === MODE.login;
        title.textContent = l ? "登录到 ProVR" : "注册新账号";
        submit.textContent = l ? "登录" : "注册";
        switcher.textContent = l ? "没有账号？立即注册" : "已有账号？返回登录";
    }

    form.onsubmit = async e => {
        e.preventDefault();
        err.textContent = "";
        const fd = new FormData(form);
        const res = await fetch("/api/" + cur, {method: "POST", body: fd});
        const j = await res.json();
        if (!res.ok) {
            err.textContent = j.detail;
            return
        }
        localStorage.token = j.token;
        location.href = "/vr";
    };
    if (localStorage.token) location.href = "/vr";
</script>
</html>